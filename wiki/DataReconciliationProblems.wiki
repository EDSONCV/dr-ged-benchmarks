#labels DR_Problems
= Data Reconciliation Benchmark Problems =
Data reconciliation are divided in 4 categories, which are the sub folders contained in /trunk/data_reconciliation folder:

    1 data_analysis 

    The aim of this problems is to test data filter (filter on the variables before DR is applied), data filter window selection and influence on the dynamics on the DR results. These problems were built using the xcos (simulink version of scilab, *compatible with scilab version 5.4*). 

Inside the data_analysis folder, we find an example called 2_tanks. The problem is a 2 tanks in parallel with measured (or unmeasured) total flows. Each tank has its own dynamic behaviour and a bypass valve to close the tanks feeding. The flowsheet is presented below:   

http://dr-ged-benchmarks.googlecode.com/svn/trunk/data_reconciliation/data_analysis/diagrams/png/2tanks.png

When the dynamic system starts:
 * At time t0 where all flow is by-passed to streams 4 and 7.
 * At time t1, the bypass valve is closed and the inlet valve of tank 1 is opened.
 * At time t2, the valve to tank 1 is closed and inlet valve to tank 2 is opened. 
 * At time t3, the inlet valves of tank 1 and 2 are closed and by-pass valve is opened.
 * Depending on the case, the user can add gross error to the measurement. The time and location can be set by the user.

There are 2 scripts in each folder. The first one is to test the influence of the size of the moving average window filter in the data reconciliation. The second one, uses a default windows size of 30 data points to filter data and perform reconciliation of all measured streams with and without filtering. The results are plotted in several windows (one for each stream).

We have four implementations of this version:

1. The dynamic behaviour is *neglected* and *all streams are measured* (in folder ss_all_measured). The block diagram can be checked below:

http://dr-ged-benchmarks.googlecode.com/svn/trunk/data_reconciliation/data_analysis/diagrams/png/2_tanks_ss_all_measured_block_diagram.png

2. 1. The dynamic behaviour is *neglected* and *some streams are unmeasured* (in folder ss_unmeasured). The block diagram can be checked below:

http://dr-ged-benchmarks.googlecode.com/svn/trunk/data_reconciliation/data_analysis/diagrams/png/2_tanks_ss_all_measured_block_diagram.png

3. The dynamic behaviour is *neglected* and *all streams are measured* but a *gross error is added* at a given time, which can be set-up by user (in folder gross_error). The user can select the time of gross error and the location by turning on-off the respective switch. The block diagram can be checked below:

http://dr-ged-benchmarks.googlecode.com/svn/trunk/data_reconciliation/data_analysis/diagrams/png/2_tanks_ss_all_measured_block_diagram.png

4. The dynamic behaviour *must be considered* and *all streams are measured* (in folder dynamic). The block diagram can be checked below:

http://dr-ged-benchmarks.googlecode.com/svn/trunk/data_reconciliation/data_analysis/diagrams/png/2_tanks_dynamic_block_diagram.png

5. The dynamic behaviour *must be considered* and *all streams are measured* and a *gross error* is added at a given time, which can be setup by user (in folder dynamic_gross_error).  The user can select the time of gross error and the location by turning on-off the respective switch. The block diagram can be checked below:

http://dr-ged-benchmarks.googlecode.com/svn/trunk/data_reconciliation/data_analysis/diagrams/png/2_tanks_dynamic_gross_error_block_diagram.png

File Structure

At the root folder of data_analysis folder we find the following files and folders:

* Files
   * dr_wls_simple.sci: Data reconciliation using weighted least squares (WLS) formulation. 
   * moving.sci: Moving average method for data filtering.

 * Folders
  * ss_all_measured: Steady state with all streams measured.
  * ss_unmeasured: Steady state with some streams measured and some unmeasured.
  * gross_error: Steady state with all streams measured and a gross error (position and time can be chosen).
  * dynamic: Different dynamic behaviour for each tank with all streams measured.
  * dynamic_gross_error: Different dynamic behaviour for each tank with all streams measured and a gross error (position and time can be chosen).

 Files inside each folder

Since the block diagrams were generated with Scilab 5.4 and Xcos (Simulink similar for Scilab), they are not compatible with older Scilab versions, in this case, a ".sav" file is available and can be loaded instead of running Xcos simulation. If you want to load a previously saved simulation data, set _run_new_ flag to 0, in the respective ".sce" script, as in the code below:
{{{
clear xm var jac nc nv i1 i2 nnzeros sparse_dg sparse_dh lower upper var_lin_type constr_lin_type constr_lhs constr_rhs
getd('../');
getd('.');
run_new = 0;
}}}  

 ss_all_measured folder

 * tanks_ss_noerror.sce: script file to open Xcos diagram, simulate, filter, reconcile data and plot results.
 * tanks_tst_window.sce: script to test moving window size. 
 * ss_no_error_mat.sav: saved simulation file, in case the user have problems with Xcos.
 * steady_state_no_ge.zcos: Xcos diagram
 * wls_linear_functions.sce: unused by now (will be used in the future)
 * wls_linear_functions.sci:unused by now (will be used in the future)

 ss_all_measured folder

In this case a simulation with all variables is carried out and a filter is used just like the case before. The difference is that in DR routine, the user can set tu unmeasured streams (in the base case 1, 2, 3 and 4). And a data reconciliation is performed (a little bit slow because we use an optimizer). The files are listed below: 

 * tanks_ss_umeas.sce: script file to open Xcos diagram, simulate, filter, reconcile data and plot results.
 * tanks_tst_window.sce: script to test moving window size. 
 * ss_no_error_mat.sav: saved simulation file, in case the user have problems with Xcos.
 * steady_state_no_ge.zcos: Xcos diagram
 * wls_linear_functions.sce: used by optimizer (weighted least squares formulation)
 * wls_linear_functions.sci:used by optimizer (weighted least squares formulation)
  
  all the other folders have basically the same structure and will not be described.

 Each folder has 3 sobfolders: 

    * diagrams: a diagram of the process in the .dia and .png format.
    * scilab: the scilab implementation.
    * spreadsheet: a Excel spreadsheet of the data, results or some data handling necessary to run the model. 
  
    2 error_in_variables 

    Error in Variables (EVM) is a problem where a DR is carried out together with parameter estimation, the aim of this problem is to test algorithms for this problem class. Since all the residuals (constraints) are non-linear, we use automatic differentiation toolbox from Scilab (diffcode) to evaluate the Hessian and Jacobian structure. The Jacobian and Hessian evaluation are done by finite difference (Scilab function "derivative"), and for this reason, some problems takes long to converge.

   We have 4 cases, collected from literature review, to test algorithms and solve strategies.

 * Heat exchanger network from Biegler and Tjoa, 1993. The idea is to reconcile data and estimate heat exchangers parameters (_U.A_)
 * Kinetic constant estimation from a CSTR from Kim, Liebman and Edgar, 1990.
 * Vapour-Liquid equilibria data estimation and reconciliation from Kim, Liebman and Edgar, 1990.
 * Gas phase catalytic hydrogenation of phenol, kinetic constant estimation and DR from Rod and Hancil.

Folder structure

 * ev_bt93: Heat exchanger network from Biegler and Tjoa.
 * ev_kle90_cstr: Kinetic constant estimation from a CSTR from Kim, Liebman and Edgar, 1990.
 * ev_kle90_vle: Vapour-Liquid equilibria data estimation and reconciliation from Kim, Liebman and Edgar, 1990
 * ev_rh80: Gas phase catalytic hydrogenation of phenol, kinetic constant estimation and DR from Rod and Hancil
 * functions:  auxiliary functions for the optimizer.

Folder : ev_bt93
 * bt93.sce: running script.
 * flowsheet_residuals.sci: mass and energy balance evaluation (constraints)
 * wls_functions_energy_balance.sci:  optimizer data (objective functions, residuals Jacobian and Hessian, structures, etc).

Since some results take long to solve, we saved some results:

 * x_sol_ok_new_var_objfun_12p_bfgs.sav
 * x_sol_ok_new_var_objfun_20p_bfgs.sav
 * x_sol_ok_new_var_objfun_20p_const_hess.sav
 * x_sol_ok_new_var_objfun_20p_exact_Hess.sav

Folder ev_kle90_cstr

 * kle90_cstr.sce: running script.
 * residuals_cstr.sci: mass and energy balance evaluation (constraints)
 * wls_functions_energy_CSTR.sci: 
optimizer data (objective functions, residuals Jacobian and Hessian, structures, etc).

Folder ev_kle90_vle

 * kle90_vle.sce: running script.
 * residuals.sci: constraints evaluation.
 * wls_functions_energy_ELV_VanL.sci: 
optimizer data (objective functions, residuals Jacobian and Hessian, structures, etc).

Folder ev_rh80

 * rh80.sce: running script.
 * residuals.sci: constraints evaluation.
 * jac_residuals.sci: unused by now.
 * wls_functions_reactor.sci:optimizer data (objective functions, residuals Jacobian and Hessian, structures, etc).
 * x_sol_ok_new_var_objfun.sav: saved results.

 Each folder has 3 sobfolders: 

    * diagrams: a diagram of the process in the .dia and .png format.
    * scilab: the scilab implementation.
    * spreadsheet: a Excel spreadsheet of the data, results or some data handling necessary to run the model. 


References

Heat Exchanger Network
 
Biegler & Tjoa, 1993
“A parallel implementation for parameter estimation with implicit models” 
Annals of Operations Research, V42, Issue 1, pp 1-23 , 1993

CSTR and VLE data

Kim, I-W; Liebman, M J;Edgar, T F
“Robust error- in-variables estimation using nonlinear programming techniques.” 
AIChE J. 1990, 36 (7), 985-993.

Gas phase catalytic hydrogenation of phenol

Rod, Vladmir and Hancil, Vladislav
Iterative Estimation of Model Parameters When Measurements of all Variables are Subject to Error. Computers & Chemical Engineering, 1980, v.4, 33-38.



    3 linear 

    In this type of problem, we deal with linear data reconciliation (total flow measurements), with all streams measured and known variance/standard deviation data.  Although linear problems are easy to solve in DR, since it have analytical solution, the aim of this problem is to test different objective function types, called robust functions. These robust functions can provide results with gross errors removed, however, to do this, some parameters must be tuned in these function. The aim of this class problems is to test these parameters set up. 

In this problem, since we use robust functions, and the derivatives are complicate to express, we use Ipopt optimizer to run the optimizations.  We also use automatic differentiation toolbox from Scilab (diffcode) to evaluate the Hessian and Jacobian structure of objective function. 

inside "linear" folder, we have 3 sobfolders: 

    * diagrams: a diagram of the process in the .dia and .png format.
    * scilab: the scilab implementation.
    * spreadsheet: a Excel spreadsheet of the data, results or some data handling necessary to run the model. 

"scilab" folder

 * functions
 * P1
 * P2
 * P3
 * P4
 * P5
 * P6
 * P7
 * P8
 * P9
 * P10
 * P11
 * P12
 * P13
 * P14
 * P15
 * P16

"functions" folder

This folder has implementation of robust and other type of objective functions, the explanation about them can be found the the references
 
 * absolute
 * cauchy
 * contamined_normal
 * fair
 * hampel
 * logistic
 * lorenztian
 * quasi_weighted
 * wls

There are also 2 files used to setup the functions, these files must not be edited by final users.

 * robust_structure.sci: method setup
 * setup_DR.sce: method selection

To select the appropriate objective function the user must select the problem folder (e.g. cd P1) and edit the selected script file (edit P1.sce). After it, the user may choose the objective function type by selection the right objective function number, e.g., to select WLS function:

{{{
// to run robust reconciliation,, one must choose between the folowing objective functions to set up the functions path and function parameters:
//WLS = 0
// Absolute sum of squares = 1
//Cauchy = 2
//Contamined Normal = 3
//Fair  = 4
//Hampel = 5
//Logistic = 6
//Lorenztian = 7
//Quasi Weighted = 8
// run the configuration functions with the desired objective function type
obj_function_type = 0;

}}}

Then the file must be saved and executed (exec P1.sce)

Problems:

P1:

http://dr-ged-benchmarks.googlecode.com/svn/trunk/data_reconciliation/linear/diagrams/png/P1.png

P2

http://dr-ged-benchmarks.googlecode.com/svn/trunk/data_reconciliation/linear/diagrams/png/P2.png

P3

http://dr-ged-benchmarks.googlecode.com/svn/trunk/data_reconciliation/linear/diagrams/png/P3.png

P4

http://dr-ged-benchmarks.googlecode.com/svn/trunk/data_reconciliation/linear/diagrams/png/P4.png

P5

http://dr-ged-benchmarks.googlecode.com/svn/trunk/data_reconciliation/linear/diagrams/png/P5.png

P6

http://dr-ged-benchmarks.googlecode.com/svn/trunk/data_reconciliation/linear/diagrams/png/P6.png

P7

http://dr-ged-benchmarks.googlecode.com/svn/trunk/data_reconciliation/linear/diagrams/png/P7.png

P8

http://dr-ged-benchmarks.googlecode.com/svn/trunk/data_reconciliation/linear/diagrams/png/P8.png

P9

http://dr-ged-benchmarks.googlecode.com/svn/trunk/data_reconciliation/linear/diagrams/png/P9.png

P10

http://dr-ged-benchmarks.googlecode.com/svn/trunk/data_reconciliation/linear/diagrams/png/P10.png

P11

http://dr-ged-benchmarks.googlecode.com/svn/trunk/data_reconciliation/linear/diagrams/png/P11.png

P12

http://dr-ged-benchmarks.googlecode.com/svn/trunk/data_reconciliation/linear/diagrams/png/P12.png

P13

http://dr-ged-benchmarks.googlecode.com/svn/trunk/data_reconciliation/linear/diagrams/png/P13.png

P14

http://dr-ged-benchmarks.googlecode.com/svn/trunk/data_reconciliation/linear/diagrams/png/P14.png

P15

http://dr-ged-benchmarks.googlecode.com/svn/trunk/data_reconciliation/linear/diagrams/png/P15.png

P16

http://dr-ged-benchmarks.googlecode.com/svn/trunk/data_reconciliation/linear/diagrams/png/P16.png


References:
Robust functions: 

Ozyurt and Pike - Comp.  & Chem. Eng.
 28, p. 381-402, (2004) 

Smooth functions according to Gopal and Biegler
 AICHE Journal 45(7) 1535-1547 - July 1999

Quasi Weighted Robust function, according to Zhang et al. - Comp.  & Chem. Eng.
34, p. 154-162-402, (2010) 



    4 non-linear 

    The aim of these problems is to test DR in more complex and non-linear problems. Some features are tested such as:

        How DR behaves with observable non-measured variables.
        How DR behaves with non-observable non-measured variables.
        How DR behaves with models which are approximated by model simplifications. 

 Each folder has 3 sobfolders: 

    * diagrams: a diagram of the process in the .dia and .png format.
    * scilab: the scilab implementation.
    * spreadsheet: a Excel spreadsheet of the data, results or some data handling necessary to run the model. 